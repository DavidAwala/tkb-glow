# Supabase `uploads` bucket â€” setup instructions

This file describes how to create and configure the `uploads` storage bucket used by the server for incoming media (images) from Twilio and admin uploads.

Recommended bucket name: `uploads`

1) Create the bucket (Supabase UI)
  - Go to the Supabase project dashboard -> Storage -> Buckets -> Create a bucket.
  - Set **Name** to `uploads`.
  - For **Public** choose either:
    - `Public` (simpler): files are accessible via public URLs.
    - `Private` (recommended for control): require signed URLs for access. The server can generate signed URLs when sending links to admin.

2) CORS / Policy notes (if using public access)
  - If the frontend needs to fetch images directly from the bucket in the browser, ensure CORS is permissive for your client origin (`http://localhost:5173` in development).
  - You can configure CORS in the Supabase Storage settings (or use the Supabase SDK to fetch signed URLs server-side).

3) Recommended RLS and policies (if private bucket)
  - Keep the bucket private and serve assets with signed URLs generated by the server using the service role key.
  - If you want admins to view uploads directly from the frontend, provide signed URLs with an expiry and return them from admin endpoints.

4) Environment variables used by server
  - `SUPABASE_URL` (already required)
  - `SUPABASE_SERVICE_ROLE_KEY` (server-only; required to upload files and generate signed URLs)
  - `SUPABASE_UPLOADS_BUCKET` (optional, default: `uploads`)

Example usage (server-side) with `@supabase/supabase-js`:

```js
const { data, error } = await supabase
  .storage
  .from(process.env.SUPABASE_UPLOADS_BUCKET || 'uploads')
  .upload(filePath, fileBuffer, { upsert: false });

// Get public URL (if public bucket)
const { publicURL } = supabase.storage.from('uploads').getPublicUrl(filePath);

// OR generate a signed URL for private bucket
const { signedURL, error } = await supabase.storage.from('uploads').createSignedUrl(filePath, 60);
```

5) Admin: testing uploads
  - After creating the bucket, try uploading a small image from the server using an existing route (Twilio webhook will also push files to the bucket).
  - Confirm you can read the file by visiting the public URL or generating a signed URL.

6) Notes
  - If using a private bucket, make sure the server uses the service role key; do NOT expose the service role key to the browser.
  - Add the bucket name to `server/.env` as `SUPABASE_UPLOADS_BUCKET=uploads` if you want to customize.
